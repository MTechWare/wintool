<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinTool - Utility Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="icon.ico">
    <link rel="stylesheet" href="styles.css">
    <style>
        .titlebar {
            -webkit-app-region: drag;
            cursor: move;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
    </style>
</head>
<body>
    <!-- Splash Screen (animated loader only) -->
    <div id="splash-screen" class="splash-overlay">
        <div class="loader">
            <div class="inner one"></div>
            <div class="inner two"></div>
            <div class="inner three"></div>
        </div>
    </div>
    <script>
        // Loader splash: animated 3D spinner
        function hideSplash() {
            const splash = document.getElementById('splash-screen');
            splash.style.opacity = 0;
            setTimeout(() => splash.style.display = 'none', 400);
        }
        // Ensure splash loader uses accent color on load
        function applySplashAccent() {
            let color = localStorage.getItem('accentColor') || '#ff9800';
            document.documentElement.style.setProperty('--primary', color);
            // Derive --primary-dark and --primary-faded for splash if needed
            try {
                // Simple shade: darken by 15%
                function darken(hex, amt) {
                    let n = parseInt(hex.replace('#', ''), 16);
                    let r = Math.max(((n >> 16) & 0xff) - amt, 0);
                    let g = Math.max(((n >> 8) & 0xff) - amt, 0);
                    let b = Math.max((n & 0xff) - amt, 0);
                    return `#${(1 << 24 | r << 16 | g << 8 | b).toString(16).slice(1)}`;
                }
                let dark = darken(color, 30);
                let faded = color.replace('#', '');
                let rf = parseInt(faded.substring(0,2),16), gf = parseInt(faded.substring(2,4),16), bf = parseInt(faded.substring(4,6),16);
                document.documentElement.style.setProperty('--primary-dark', dark);
                document.documentElement.style.setProperty('--primary-faded', `rgba(${rf},${gf},${bf},0.22)`);
            } catch(e) {}
        }
        document.addEventListener('DOMContentLoaded', function() {
            applySplashAccent();
            setTimeout(hideSplash, 1200);

            // Tab sidebar collapse/expand logic
            const sidebarFoldToggle = document.getElementById('sidebar-fold-toggle');
            const tabList = document.getElementById('winToolTabs');
            let collapsed = false;

            function setSidebarCollapsed(state, updateCheckbox = true) {
                collapsed = state;
                tabList.classList.toggle('collapsed', collapsed);
                if (updateCheckbox && sidebarFoldToggle) sidebarFoldToggle.checked = collapsed;
                // Persist state
                localStorage.setItem('sidebarCollapsed', collapsed ? '1' : '0');
            }

            // Settings tab checkbox logic
            if (sidebarFoldToggle) {
                sidebarFoldToggle.addEventListener('change', function(e) {
                    setSidebarCollapsed(e.target.checked, false);
                });
            }

            // Restore sidebar state from localStorage
            const savedCollapsed = localStorage.getItem('sidebarCollapsed');
            setSidebarCollapsed(savedCollapsed === '1', true);
        });
    </script>
    <div class="titlebar">
        <div class="window-title"></div>
        <div class="window-controls">
            <button type="button" class="window-btn" id="closeBtn" title="Close">&#10005;</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const closeBtn = document.getElementById('closeBtn');
            if (closeBtn && window.electronAPI) {
                closeBtn.addEventListener('click', function() {
                    window.electronAPI.closeWindow && window.electronAPI.closeWindow();
                });
            }
        });
    </script>
    <div class="main-flex">
        <div class="sidebar" style="display:flex;flex-direction:column;align-items:stretch;height:100vh;background:#111113;border-right:1.5px solid #19191c;min-width:160px;max-width:220px;width:200px;">
            <div class="sidebar-logo" style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.2em 0 0.3em 0;">
                <img src="WT.png" alt="WinTool Logo" style="width:108px;height:108px;border-radius:24px;box-shadow:0 2px 18px #23232a80;" />
                <div class="sidebar-brand-label" style="margin-top:0.1em;font-size:1.1rem;font-weight:700;color:var(--primary);letter-spacing:0.03em;text-shadow:0 1px 4px #23232a60;">WinTool</div>
            </div>
            <ul class="tab-list" id="winToolTabs">
                <li class="tab-item active" data-tab="welcome"><i class="fas fa-home"></i><span>Welcome</span></li>
                <li class="tab-item" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></li>
                <li class="tab-item" data-tab="tweaks"><i class="fas fa-bolt"></i><span>Tweaks</span></li>
                <li class="tab-item" data-tab="packages"><i class="fas fa-box-open"></i><span>Packages</span></li>
                <li class="tab-item" data-tab="tools"><i class="fas fa-toolbox"></i><span>System Tools</span></li>
                <li class="tab-item" data-tab="gaming"><i class="fas fa-gamepad"></i><span>Gaming & Performance</span></li>
                <li class="tab-item" data-tab="setup"><i class="fas fa-cog"></i><span>Unattended Setup</span></li>
                <li class="tab-item" data-tab="settings"><i class="fas fa-sliders-h"></i><span>Settings</span></li>
                <li class="tab-item" data-tab="about"><i class="fas fa-info-circle"></i><span>About</span></li>
            </ul>
        </div>
        <div class="angular-border">
            <div id="tab-welcome" class="tab-content active" data-aos="fade-in">
                <div class="welcome-card bg-neutral-900 rounded-lg border border-neutral-700 shadow-lg p-8 max-w-xl mx-auto mt-10 text-center">
                    <h1 class="text-3xl font-bold mb-2 text-orange-400">Welcome to WinTool!</h1>
                    <p class="mb-4 text-lg text-gray-300">Your all-in-one Windows management and tweaks dashboard.</p>
                    <div class="announcements bg-neutral-800 border border-orange-400 rounded-md p-4 mb-4">
                        <div class="font-semibold text-orange-300 mb-2" style="font-size:1.1rem;">Latest Announcements</div>
                        <ul class="list-disc list-inside text-gray-200 text-left" style="margin-left:1.2em;">
                            <li>Welcome to WinTool v0.0.3a!</li>
                            <li><b>NEW:</b>Added support for custom accent colors.</li>
                            <li><b>NEW:</b> FPS Counter toggle in Settings tab.</li>
                            <li><b>NEW:</b>Gaming & Performance tab.</li>
                            <li><b>NEW:</b>You can move tabs and it will save the order.</li>
                            <li><b>NEW:</b>Always on Top toggle in Settings tab.</li>
                            <li><b>NEW:</b>Fold Sidebar Tabs toggle in Settings tab.</li>
                            <li>Reset tab order to default is in Settings tab.</li>
                            <li>Improved error handling throughout the app.</li>
                            <li>Splash screen can be a custom color.</li>
                        </ul>
                    </div>
                    <p class="text-gray-400">Select a tab on the right to get started.</p>
                    <div class="mt-6 flex justify-center">
                        <a href="https://discord.gg/nCmEQ8zaa7" target="_blank" rel="noopener" class="btn btn-secondary flex items-center gap-2 px-5 py-2 text-lg" style="background:#ff9800;color:#fff;border:none;border-radius:0.5rem;box-shadow:0 2px 8px #23232a80;transition:background 0.2s;">
                            <i class="fab fa-discord" style="font-size:1.4em;"></i> Join our Discord
                        </a>
                    </div>
                </div>
            </div>
            <div id="tab-dashboard" class="tab-content" data-aos="fade-in">
                <script>
                    // Initialize elements
                    let sysOsEl = null;
                    let sysHostEl = null;
                    let sysUserEl = null;
                    let cpuUsageEl = null;
                    let ramUsageEl = null;
                    let diskUsageEl = null;
                    let netUsageEl = null;

                    // Format uptime in days, hours, minutes, seconds
                    function formatUptime(seconds) {
                        const d = Math.floor(seconds / 86400);
                        const h = Math.floor((seconds % 86400) / 3600);
                        const m = Math.floor((seconds % 3600) / 60);
                        const s = Math.floor(seconds % 60);
                        let str = '';
                        if (d) str += `${d}d `;
                        if (h) str += `${h}h `;
                        if (m) str += `${m}m `;
                        str += `${s}s`;
                        return str;
                    }

                    async function updateSystemInfo() {
                        try {
                            // Only update if dashboard tab is visible
                            const dashboardTab = document.getElementById('tab-dashboard');
                            if (!dashboardTab || !dashboardTab.classList.contains('active')) {
                                return;
                            }

                            const data = await window.electronAPI.getSystemInfo();
                            if (!data) return;

                            // Initialize elements if they haven't been cached yet
                            if (!sysOsEl) sysOsEl = document.getElementById('sys-os');
                            if (!sysHostEl) sysHostEl = document.getElementById('sys-host');
                            if (!sysUserEl) sysUserEl = document.getElementById('sys-user');
                            if (!cpuUsageEl) cpuUsageEl = document.getElementById('cpu-usage');
                            if (!ramUsageEl) ramUsageEl = document.getElementById('ram-usage');
                            if (!diskUsageEl) diskUsageEl = document.getElementById('disk-usage');
                            if (!netUsageEl) netUsageEl = document.getElementById('net-usage');

                            if (sysOsEl) sysOsEl.innerText = data.os || '--';
                            if (sysHostEl) sysHostEl.innerText = data.hostname || '--';
                            if (sysUserEl) sysUserEl.innerText = data.user || '--';
                            if (cpuUsageEl) cpuUsageEl.innerText = data.cpu !== undefined ? `${data.cpu.toFixed(1)}%` : '--';
                            if (ramUsageEl) ramUsageEl.innerText = (data.ram && data.ram.used !== undefined && data.ram.total !== undefined) ? `${(data.ram.used/1073741824).toFixed(1)} GB / ${(data.ram.total/1073741824).toFixed(1)} GB` : '--';
                            if (diskUsageEl) diskUsageEl.innerText = (data.disk && data.disk.percent !== undefined) ? `${data.disk.percent}%` : '--';
                            if (netUsageEl) {
                                const netMbps = (data.net && data.net.bytes_recv !== undefined && data.net.bytes_sent !== undefined) ? (((data.net.bytes_recv + data.net.bytes_sent) / 1024 / 1024).toFixed(2)) : '--';
                                netUsageEl.innerText = `${netMbps !== '--' ? netMbps + ' MB' : '--'}`;
                            }
                            const dashboardUptimeEl = document.getElementById('dashboard-uptime');
                            if (dashboardUptimeEl && data.uptime_seconds !== undefined) {
                                dashboardUptimeEl.textContent = formatUptime(data.uptime_seconds);
                            }
                        } catch (error) {
                            console.error("Error updating system info:", error);
                        }
                    }

                    // Start updates only after DOM is loaded and elements are found
                    document.addEventListener('DOMContentLoaded', () => {
                        updateSystemInfo();
                        setInterval(updateSystemInfo, 2000);
                    });

                    async function quickAction(action) {
                        switch (action) {
                            case 'disk_cleanup':
                                await window.electronAPI.launchDiskCleanup();
                                break;
                            case 'task_manager':
                                await window.electronAPI.launchTaskManager();
                                break;
                            case 'security_center':
                                await window.electronAPI.launchSystemTool('security_center');
                                break;
                            case 'power_options':
                                await window.electronAPI.launchSystemTool('power_options');
                                break;
                            default:
                                showErrorNotification('Unknown quick action: ' + action);
                        }
                    }
                </script>

                <div class="feature-section">
                    <h3><i class="fas fa-chart-line"></i>System Overview</h3>
                    <p>System Information for your Windows system.</p>
                    <div class="feature-grid mb-4">
                        <div class="info-card"><div class="label">OS</div><div class="value" id="sys-os">...</div></div>
                        <div class="info-card"><div class="label">Hostname</div><div class="value" id="sys-host">...</div></div>
                        <div class="info-card"><div class="label">User</div><div class="value" id="sys-user">...</div></div>
                    </div>
                    <p>Real-time system monitoring (CPU, RAM, Disk) and quick actions hub.</p>
                    <div class="feature-grid">
                        <div class="info-card"><div class="label">CPU Usage</div><div class="value" id="cpu-usage">...</div></div>
                        <div class="info-card"><div class="label">RAM Usage</div><div class="value" id="ram-usage">...</div></div>
                        <div class="info-card"><div class="label">Disk C: Activity</div><div class="value" id="disk-usage">...</div></div>
                        <div class="info-card" id="uptime-dashboard-card">
                            <div class="label">Uptime</div>
                            <div class="value" id="dashboard-uptime">--</div>
                        </div>
                    </div>
                </div>
                <div class="feature-section">
                    <h3><i class="fas fa-bolt"></i>Quick Actions</h3>
                    <div class="flex flex-wrap gap-3 justify-center">
                        <button type="button" class="btn btn-secondary" onclick="quickAction('disk_cleanup')"><i class="fas fa-broom"></i>Run Disk Cleanup</button>
                        <button type="button" class="btn btn-secondary" onclick="quickAction('task_manager')"><i class="fas fa-tasks"></i>Open Task Manager</button>
                        <button type="button" class="btn btn-secondary" onclick="quickAction('security_center')"><i class="fas fa-shield-alt"></i>Security Center</button>
                        <button type="button" class="btn btn-secondary" onclick="quickAction('power_options')"><i class="fas fa-power-off"></i>Power Options</button>
                    </div>
                </div>
                <script>
                    async function fetchDashboardUptime() {
                        try {
                            const data = await window.electronAPI.getSystemInfo();
                            const dashboardUptimeEl = document.getElementById('dashboard-uptime');
                            if (dashboardUptimeEl && data && data.uptime_seconds !== undefined) dashboardUptimeEl.textContent = formatUptime(data.uptime_seconds);
                        } catch (error) {
                            const dashboardUptimeEl = document.getElementById('dashboard-uptime');
                            if (dashboardUptimeEl) dashboardUptimeEl.textContent = '--';
                        }
                    }
                    function formatUptime(seconds) {
                        const d = Math.floor(seconds / 86400);
                        const h = Math.floor((seconds % 86400) / 3600);
                        const m = Math.floor((seconds % 3600) / 60);
                        const s = Math.floor(seconds % 60);
                        let str = '';
                        if (d) str += `${d}d `;
                        if (h) str += `${h}h `;
                        if (m) str += `${m}m `;
                        str += `${s}s`;
                        return str;
                    }
                    fetchDashboardUptime();
                    setInterval(fetchDashboardUptime, 3000);
                </script>
            </div>

            <div id="tab-tweaks" class="tab-content" data-aos="fade-in"> 
                <div id="tweaks-loading" style="margin:2rem;text-align:center;">Loading tweaks...</div>
                <div id="tweaks-list" class="tweaks-grid" style="display:none;"></div>
                <script>
                    async function fetchTweaks() {
                        document.getElementById('tweaks-loading').style.display = '';
                        document.getElementById('tweaks-list').style.display = 'none';
                        document.getElementById('tweaks-loading').innerText = 'Loading tweaks...';
                        try {
                            const raw = await window.electronAPI.getCurrentTweaks();
                            console.log('getCurrentTweaks returned:', raw);
                            // Normalize registry values
                            const norm = {};
                            Object.entries(raw).forEach(([k, v]) => {
                                let nv = v;
                                if (typeof v === 'string') {
                                    if (v.startsWith('0x')) nv = parseInt(v, 16);
                                    else if (v === 'true' || v === 'false') nv = (v === 'true');
                                    else if (!isNaN(Number(v))) nv = Number(v);
                                }
                                norm[k] = nv;
                            });
                            let data = norm;
                            // Transform tweaks object into an array for renderTweaksList
                            const tweaksArr = [
                                {
                                    key: 'visualfx',
                                    label: 'Visual Effects',
                                    description: 'Adjusts Windows visual effects for performance or appearance.',
                                    enabled: data.visualfx === 2
                                },
                                {
                                    key: 'show_hidden_files',
                                    label: 'Show Hidden Files',
                                    description: 'Show or hide hidden files and folders in File Explorer.',
                                    enabled: data.show_hidden_files == 1
                                },
                                {
                                    key: 'file_extensions',
                                    label: 'Show File Extensions',
                                    description: 'Show or hide file extensions for known file types.',
                                    enabled: data.file_extensions == 0
                                },
                                {
                                    key: 'disable_telemetry',
                                    label: 'Disable Telemetry',
                                    description: 'Disables Windows telemetry (diagnostic data collection).',
                                    enabled: data.disable_telemetry == 0
                                },
                                {
                                    key: 'disable_advertising_id',
                                    label: 'Disable Advertising ID',
                                    description: 'Prevents apps from using your advertising ID for experiences across apps.',
                                    enabled: data.disable_advertising_id == 0
                                },
                                {
                                    key: 'show_this_pc_on_desktop',
                                    label: 'Show This PC on Desktop',
                                    description: 'Displays the This PC icon on the desktop.',
                                    enabled: data.show_this_pc_on_desktop == 0
                                },
                                {
                                    key: 'show_recycle_bin_on_desktop',
                                    label: 'Show Recycle Bin on Desktop',
                                    description: 'Displays the Recycle Bin icon on the desktop.',
                                    enabled: data.show_recycle_bin_on_desktop == 0
                                },
                                {
                                    key: 'disable_lock_screen',
                                    label: 'Disable Lock Screen',
                                    description: 'Removes the lock screen for faster access to your desktop.',
                                    enabled: data.disable_lock_screen == 1
                                },
                                {
                                    key: 'disable_cortana',
                                    label: 'Disable Cortana',
                                    description: 'Disables Cortana, the personal assistant.',
                                    enabled: data.disable_cortana == 0
                                },
                                {
                                    key: 'small_taskbar_buttons',
                                    label: 'Use Small Taskbar Buttons',
                                    description: 'Use smaller icons on the taskbar.',
                                    enabled: data.small_taskbar_buttons == 1
                                },
                                {
                                    key: 'show_seconds_on_taskbar_clock',
                                    label: 'Show Seconds on Taskbar Clock',
                                    description: 'Show seconds in the Windows taskbar clock.',
                                    enabled: data.show_seconds_on_taskbar_clock == 1
                                },
                                {
                                    key: 'disable_startup_sound',
                                    label: 'Disable Startup Sound',
                                    description: 'Disables the Windows startup sound.',
                                    enabled: data.disable_startup_sound == 1
                                },
                                {
                                    key: 'disable_animations',
                                    label: 'Disable Animations',
                                    description: 'Disables UI animations for improved performance.',
                                    enabled: data.disable_animations == 2
                                }
                            ];
                            console.log('renderTweaksList tweaksArr:', tweaksArr);
                            renderTweaksList(tweaksArr);
                            document.getElementById('tweaks-loading').style.display = 'none';
                            document.getElementById('tweaks-list').style.display = '';
                        } catch (e) {
                            document.getElementById('tweaks-loading').innerText = 'Failed to load tweaks.';
                            showErrorNotification('Failed to load tweaks.');
                        }
                    }
                    function renderTweaksList(tweaks) {
                        const list = document.getElementById('tweaks-list');
                        list.innerHTML = '';
                        // Group tweaks by category
                        const categories = [
                            { name: 'Privacy', keys: ['disable_telemetry','disable_advertising_id','disable_cortana'] },
                            { name: 'Desktop & Explorer', keys: ['show_this_pc_on_desktop','show_recycle_bin_on_desktop','show_hidden_files','file_extensions'] },
                            { name: 'Taskbar & Start', keys: ['small_taskbar_buttons','show_seconds_on_taskbar_clock'] },
                            { name: 'Performance & UI', keys: ['visualfx','disable_animations','disable_startup_sound','disable_lock_screen'] }
                        ];
                        tweaks.forEach(tweak => {
                            let cat = categories.find(c => c.keys.includes(tweak.key)) || categories[categories.length-1];
                            if (!cat.tweaks) cat.tweaks = [];
                            cat.tweaks.push(tweak);
                        });
                        categories.forEach(cat => {
                            if (cat.tweaks && cat.tweaks.length) {
                                const catDiv = document.createElement('div');
                                catDiv.className = 'tweaks-category';
                                catDiv.innerHTML = `<h3>${cat.name}</h3>`;
                                cat.tweaks.forEach(tweak => {
                                    const row = document.createElement('div');
                                    row.className = 'tweak-row';
                                    row.style.display = 'flex';
                                    row.style.alignItems = 'center';
                                    row.style.marginBottom = '0.5rem';
                                    row.innerHTML = `
                                        <label style="flex:1;cursor:pointer;" for="tweak-${tweak.key}">
                                            <span style="font-weight:600;">${tweak.label}</span><br>
                                            <span style="font-size:0.94em;color:#b0b0b0;">${tweak.description}</span>
                                        </label>
                                        <label class="switch">
                                            <input type="checkbox" id="tweak-${tweak.key}" ${tweak.enabled ? 'checked' : ''} tabindex="0">
                                            <span class="slider"></span>
                                        </label>
                                    `;
                                    // Add change event for instant apply
                                    setTimeout(() => {
                                        row.querySelector('input[type=checkbox]').addEventListener('change', async function() {
                                            const key = this.id.replace('tweak-','');
                                            const checked = this.checked;
                                            let value;
                                            switch (key) {
                                                case 'visualfx': value = checked ? 2 : 3; break;
                                                case 'disable_animations': value = checked ? 2 : 1; break;
                                                case 'show_hidden_files': value = checked ? 1 : 2; break;
                                                case 'file_extensions': value = checked ? 0 : 1; break;
                                                case 'disable_telemetry': value = checked ? 0 : 1; break;
                                                case 'disable_advertising_id': value = checked ? 0 : 1; break;
                                                case 'show_this_pc_on_desktop': value = checked ? 0 : 1; break;
                                                case 'show_recycle_bin_on_desktop': value = checked ? 0 : 1; break;
                                                case 'disable_lock_screen': value = checked ? 1 : 0; break;
                                                case 'disable_cortana': value = checked ? 0 : 1; break;
                                                case 'small_taskbar_buttons': value = checked ? 1 : 0; break;
                                                case 'show_seconds_on_taskbar_clock': value = checked ? 1 : 0; break;
                                                case 'disable_startup_sound': value = checked ? 1 : 0; break;
                                                default: value = checked ? 1 : 0;
                                            }
                                            const tweaks = {};
                                            tweaks[key] = value;
                                            console.log('Attempting to apply tweak:', tweaks); // Log the object being sent
                                            try {
                                                const result = await window.electronAPI.applyTweaks(tweaks);
                                                console.log('applyTweaks result:', result); // Log the result from backend
                                                if (result && result.errors && result.errors.length > 0) {
                                                    console.error('Backend reported errors applying tweak:', result.errors);
                                                    showErrorNotification('Failed to apply tweak: ' + result.errors.join('\n'));
                                                } else {
                                                    showNotification(`${tweak.label} has been turned ${checked ? 'on' : 'off'}.`, { type: 'success' });
                                                }
                                                // Add a small delay before refetching to allow registry changes to potentially settle
                                                setTimeout(fetchTweaks, 250); // Increased delay slightly
                                            } catch (e) {
                                                showErrorNotification('Failed to apply tweak: ' + e.message);
                                            }
                                        });
                                    }, 0);
                                    catDiv.appendChild(row);
                                });
                                list.appendChild(catDiv);
                            }
                        });
                    }
                    document.addEventListener('DOMContentLoaded', () => {
                        if (document.getElementById('tab-tweaks')) fetchTweaks();
                    });
                </script>
            </div>

            <div id="tab-gaming" class="tab-content" data-aos="fade-in" style="display:none; max-height: 80vh; overflow-y: auto; padding-bottom: 2rem;">
                <div class="feature-section">
                    <h3><i class="fas fa-gamepad"></i> Gaming & Performance</h3>
                    <p>Boost your system for gaming and demanding workloads. Apply tweaks, monitor performance, and access tools designed for gamers and power users.</p>
                    <div class="feature-grid mb-4">
                        <!-- Game Mode Tweaks -->
                        <div class="info-card flex flex-col items-center justify-between" style="border: 1.5px solid var(--primary);">
                            <div class="label flex items-center gap-2 text-lg"><i class="fas fa-rocket text-primary"></i>Game Mode</div>
                            <div class="text-gray-300 text-sm my-2 text-center">Enable or disable Windows Game Mode for optimized gaming performance.</div>
                            <label class="inline-flex items-center cursor-pointer mt-2">
                                <input type="checkbox" id="toggle-game-mode" class="form-checkbox h-5 w-5 text-primary">
                                <span class="ml-2 text-gray-200">Enable Game Mode</span>
                            </label>
                        </div>
                        <!-- Performance Profiles -->
                        <div class="info-card flex flex-col items-center justify-between" style="border: 1.5px solid var(--primary);">
                            <div class="label flex items-center gap-2 text-lg"><i class="fas fa-tachometer-alt text-primary"></i>Performance Profile</div>
                            <div class="text-gray-300 text-sm my-2 text-center">Switch between Windows power plans for different performance needs.</div>
                            <div class="flex flex-col gap-2 mt-2 w-full">
                                <button class="btn btn-secondary btn-sm w-full" id="btn-power-balanced" style="border:none;">Balanced</button>
                                <button class="btn btn-secondary btn-sm w-full" id="btn-power-high" style="border:none;">High Performance</button>
                            </div>
                        </div>
                        <!-- Memory & Latency Tweaks -->
                        <div class="info-card flex flex-col items-center justify-between" style="border: 1.5px solid var(--primary);">
                            <div class="label flex items-center gap-2 text-lg"><i class="fas fa-memory text-primary"></i>Memory & Latency</div>
                            <div class="text-gray-300 text-sm my-2 text-center">Free up RAM and reduce system latency for smoother gaming.</div>
                            <button class="btn btn-secondary mt-2 w-full" id="btn-optimize-ram">Optimize RAM</button>
                        </div>
                    </div>
                </div>
                <script>
                    // Make the border color of the Performance Profile and Memory & Latency cards changeable
                    document.addEventListener('DOMContentLoaded', () => {
                        const profileColorInput = document.getElementById('profile-border-color');
                        if (profileColorInput) {
                            profileColorInput.addEventListener('input', (e) => {
                                document.documentElement.style.setProperty('--profile-border-color', e.target.value);
                            });
                            // Set initial value
                            document.documentElement.style.setProperty('--profile-border-color', profileColorInput.value);
                        }
                        const memoryColorInput = document.getElementById('memory-border-color');
                        if (memoryColorInput) {
                            memoryColorInput.addEventListener('input', (e) => {
                                document.documentElement.style.setProperty('--memory-border-color', e.target.value);
                            });
                            // Set initial value
                            document.documentElement.style.setProperty('--memory-border-color', memoryColorInput.value);
                        }
                    });
                </script>
            </div>

            <div id="tab-packages" class="tab-content" data-aos="fade-in"> 
                <script>
                    // --- Modern, robust Packages Tab logic ---
                    document.addEventListener('DOMContentLoaded', () => {
                        const installBtn = document.getElementById('pm-install-btn');
                        const uninstallBtn = document.getElementById('pm-uninstall-btn');
                        const updateBtn = document.getElementById('pm-update-btn');
                        const refreshBtn = document.getElementById('pm-refresh-btn');
                        const descBox = document.getElementById('package-desc-box');
                        const filterSelect = document.querySelector('.pm-filter-bar .select-field');
                        const searchInput = document.querySelector('.pm-filter-bar .input-field');
                        const summary = document.querySelector('.pm-summary span');
                        const packageListBody = document.getElementById('package-list-body');

                        let packages = [];
                        let grouped = {};

                        // --- Fetch packages from backend (Electron IPC) ---
                        async function fetchPackages() {
                            console.log('Packages tab script loaded');
                            packageListBody.innerHTML = '<tr><td colspan="2">Loading packages...</td></tr>';
                            try {
                                // Use the Electron preload bridge instead of fetch()
                                const data = await window.electronAPI.getPackages();
                                console.log('Fetched packages:', data);
                                if (!data || data.error) {
                                    packageListBody.innerHTML = `<tr><td colspan="2">${data && data.error ? data.error : 'Error loading packages.'}</td></tr>`;
                                    packages = [];
                                    if (data && data.error) showErrorNotification(data.error);
                                    return;
                                }
                                if (!Array.isArray(data)) {
                                    packageListBody.innerHTML = '<tr><td colspan="2">Error loading packages.</td></tr>';
                                    packages = [];
                                    showErrorNotification('Error loading packages.');
                                    return;
                                }
                                packages = data;
                                renderTable();
                            } catch (e) {
                                packageListBody.innerHTML = '<tr><td colspan="2">Error loading packages.</td></tr>';
                                packages = [];
                                showErrorNotification('Error loading packages.');
                            }
                        }

                        // --- Render the packages table ---
                        function renderTable() {
                            grouped = {};
                            const selectedCat = filterSelect.value;
                            const search = searchInput.value.toLowerCase();
                            packages.forEach(pkg => {
                                const cat = (pkg.category||'Other').toLowerCase();
                                if ((selectedCat === 'all' || cat === selectedCat) && (pkg.content||pkg.id).toLowerCase().includes(search)) {
                                    if (!grouped[cat]) grouped[cat] = [];
                                    grouped[cat].push(pkg);
                                }
                            });
                            let html = '';
                            Object.keys(grouped).sort().forEach(cat => {
                                html += `<tr class="category-row" data-category="${cat}"><td colspan="2"><i class="fas fa-folder fa-chevron-down"></i> ${cat.charAt(0).toUpperCase() + cat.slice(1)}</td></tr>`;
                                grouped[cat].forEach(pkg => {
                                    html += `<tr data-package-id="${pkg.id}" data-category="${cat}">
                                        <td>${pkg.content||pkg.id}</td>
                                        <td class="col-desc">${pkg.description||''}</td>
                                    </tr>`;
                                });
                            });
                            packageListBody.innerHTML = html || '<tr><td colspan="2">No packages found.</td></tr>';
                            let pkgCount = 0; Object.values(grouped).forEach(arr => pkgCount += arr.length);
                            summary.innerHTML = `${pkgCount} WinGet Packages in ${Object.keys(grouped).length} Categories`;
                            updateActionButtons();
                        }

                        // --- Combined click handler for selection and category collapse ---
                        packageListBody.addEventListener('click', (event) => {
                            const categoryRow = event.target.closest('tr.category-row');
                            if (categoryRow) {
                                const cat = categoryRow.dataset.category;
                                const icon = categoryRow.querySelector('i');
                                if (icon) {
                                    categoryRow.classList.toggle('collapsed');
                                    icon.classList.toggle('fa-chevron-down');
                                    icon.classList.toggle('fa-chevron-right');
                                }
                                let currentRow = categoryRow.nextElementSibling;
                                while (currentRow && !currentRow.classList.contains('category-row')) {
                                    if (currentRow.dataset.category === cat) {
                                        currentRow.style.display = categoryRow.classList.contains('collapsed') ? 'none' : 'table-row';
                                    }
                                    currentRow = currentRow.nextElementSibling;
                                }
                                event.stopImmediatePropagation();
                                return;
                            }
                            const clickedRow = event.target.closest('tr[data-package-id]');
                            if (!clickedRow) return;
                            if (event.ctrlKey || event.metaKey) {
                                clickedRow.classList.toggle('selected');
                            } else {
                                packageListBody.querySelectorAll('tr.selected').forEach(row => row.classList.remove('selected'));
                                clickedRow.classList.add('selected');
                            }
                            updateActionButtons();
                        });

                        // --- Selection, keyboard, and description logic ---
                        packageListBody.addEventListener('keydown', (event) => {
                            if (event.target.tagName !== 'TR') return;
                            if (event.key === ' ' || event.key === 'Enter') {
                                event.preventDefault();
                                event.target.click();
                            }
                        });

                        // --- Action buttons logic ---
                        function updateActionButtons() {
                            const selectedRows = packageListBody.querySelectorAll('tr.selected');
                            installBtn.disabled = selectedRows.length === 0;
                            uninstallBtn.disabled = selectedRows.length === 0;
                            updateBtn.disabled = selectedRows.length === 0;
                            // Description box
                            if (selectedRows.length === 1) {
                                const pkgId = selectedRows[0].dataset.packageId;
                                const pkg = packages.find(p => p.id === pkgId);
                                descBox.innerHTML = pkg ? `<b>${pkg.content||pkg.id}</b><br>${pkg.description||''}` : '';
                            } else if (selectedRows.length > 1) {
                                descBox.innerHTML = `${selectedRows.length} packages selected.`;
                            } else {
                                descBox.innerHTML = 'Select a package to see details.';
                            }
                        }

                        // --- Action handlers ---
                        installBtn.onclick = () => doPackageAction('install');
                        uninstallBtn.onclick = () => doPackageAction('uninstall');
                        updateBtn.onclick = () => doPackageAction('update');
                        refreshBtn.onclick = fetchPackages;
                        filterSelect.onchange = renderTable;
                        searchInput.oninput = renderTable;

                        // --- Package actions ---
                        async function doPackageAction(action) {
                            const selected = Array.from(packageListBody.querySelectorAll('tr.selected'));
                            if (!selected.length) return;
                            setPackageProgress(0, selected.length);
                            let done = 0;
                            for (const row of selected) {
                                const id = row.getAttribute('data-package-id');
                                let pkgName = row.querySelector('td') ? row.querySelector('td').textContent : id;
                                // Show notification before starting the action
                                if (action === 'install') {
                                    showNotification(`Installing: ${pkgName}...`, { type: 'info' });
                                } else if (action === 'uninstall') {
                                    showNotification(`Uninstalling: ${pkgName}...`, { type: 'info' });
                                }
                                try {
                                    await window.electronAPI.packageAction(action, id);
                                    if (action === 'install') {
                                        showNotification(`Installed: ${pkgName}`, { type: 'success' });
                                    } else if (action === 'uninstall') {
                                        showNotification(`Uninstalled: ${pkgName}`, { type: 'info' });
                                    }
                                } catch (e) {
                                    showErrorNotification('Failed to ' + action + ' package: ' + e.message);
                                }
                                done++;
                                setPackageProgress(done, selected.length);
                            }
                            setTimeout(() => setPackageProgress(0, 0), 800);
                            fetchPackages();
                        }
                        function setPackageProgress(current, total) {
                            const bar = document.getElementById('package-progress-bar');
                            const inner = document.getElementById('package-progress-inner');
                            if (total > 0) {
                                bar.style.display = '';
                                inner.style.width = Math.round((current/total)*100) + '%';
                            } else {
                                bar.style.display = 'none';
                                inner.style.width = '0%';
                            }
                        }

                        // --- Initial load ---
                        fetchPackages();
                    });
                </script>

                <div class="package-manager-container">
                    <div class="pm-header">
                        <div>
                            <div class="pm-title">WinGet Package Manager</div>
                            <div class="pm-subtitle">(Hold Ctrl + Left Click to select multiple)</div>
                        </div>
                        <div class="pm-status ready">Ready</div>
                    </div>

                    <div class="pm-filter-bar">
                        <input type="text" placeholder="Search packages..." class="input-field">
                        <select class="select-field">
                            <option value="all">Category: All</option>
                            <option value="utilities">Category: Utilities</option>
                            <option value="dev">Category: Development</option>
                            <option value="media">Category: Media</option>
                        </select>
                    </div>

                    <div class="pm-summary">
                        <i class="fas fa-info-circle"></i><span>0 WinGet Packages in 0 Categories</span>
                    </div>

                    <div id="package-progress-bar" style="height: 8px; background: #333; border-radius: 4px; overflow: hidden; margin-bottom: 0.5rem; display: none;">
                        <div id="package-progress-inner" style="height:100%;width:0%;background:linear-gradient(90deg,#ff9800,#ff5722);transition:width 0.3s;"></div>
                    </div>

                    <div class="pm-table-wrapper">
                        <table class="pm-table">
                            <thead>
                                <tr>
                                    <th class="col-name">Name</th>
                                    <th class="col-desc">Description</th>
                                </tr>
                            </thead>
                            <tbody id="package-list-body">
                            </tbody>
                        </table>
                    </div>

                    <div class="pm-actions-bar">
                        <button class="action-btn" id="pm-install-btn" disabled><i class="fas fa-download"></i>Install</button>
                        <button class="action-btn" id="pm-uninstall-btn" disabled><i class="fas fa-times"></i>Uninstall</button>
                        <button class="action-btn" id="pm-update-btn" disabled><i class="fas fa-sync-alt"></i>Update</button>
                        <button class="action-btn refresh-btn" id="pm-refresh-btn"><i class="fas fa-redo"></i>Refresh</button>
                    </div>
                    <div id="package-desc-box" class="mt-4 p-4 bg-neutral-800 rounded border border-neutral-700"></div>
                </div>
            </div>

            <div id="tab-tools" class="tab-content" data-aos="fade-in"> 
                <div class="feature-section">
                    <h3><i class="fas fa-toolbox"></i>System Tools</h3>
                    <p>Access essential built-in Windows tools quickly.</p>
                    <div class="feature-grid" id="system-tools-grid"></div>
                </div>
                <script>
                    const SYSTEM_TOOLS = [
                        { id: 'disk_cleanup', label: 'Disk Cleanup', icon: 'fas fa-hdd', desc: 'Free up disk space' },
                        { id: 'task_manager', label: 'Task Manager', icon: 'fas fa-tasks', desc: 'Manage running processes' },
                        { id: 'msconfig', label: 'System Configuration', icon: 'fas fa-cog', desc: 'msconfig utility' },
                        { id: 'system_info', label: 'System Information', icon: 'fas fa-info-circle', desc: 'View hardware/software details' },
                        { id: 'cmd', label: 'Command Prompt', icon: 'fas fa-terminal', desc: 'Open CMD (Admin)' }
                    ];
                    function renderSystemTools() {
                        const grid = document.getElementById('system-tools-grid');
                        grid.innerHTML = '';
                        SYSTEM_TOOLS.forEach(tool => {
                            const btn = document.createElement('button');
                            btn.className = 'info-card clickable tool-card text-left';
                            btn.innerHTML = `<div class="value text-lg"><i class="${tool.icon} mr-2 system-tool-icon"></i>${tool.label}</div><div class="label">${tool.desc}</div>`;
                            btn.onclick = () => launchSystemTool(tool.id);
                            grid.appendChild(btn);
                        });
                    }
                    async function launchSystemTool(id) {
                        try {
                            const result = await window.electronAPI.launchSystemTool(id);
                            // Optionally, show a success message
                        } catch (err) {
                            showErrorNotification('Error launching system tool: ' + err);
                        }
                    }
                    document.addEventListener('DOMContentLoaded', renderSystemTools);
                </script>
            </div>

            <div id="tab-setup" class="tab-content" data-aos="fade-in">
                <div class="feature-section">
                    <h3><i class="fas fa-cog"></i>Unattended Setup</h3>
                    <div class="unattend-wizard bg-neutral-900 rounded-lg border border-neutral-700 shadow-lg p-6 max-w-2xl mx-auto">
                        <div class="wizard-tabs flex mb-4 gap-2">
                            <button class="wizard-tab active" data-tab="system">System</button>
                            <button class="wizard-tab" data-tab="regional">Regional</button>
                            <button class="wizard-tab" data-tab="user">User Account</button>
                            <button class="wizard-tab" data-tab="privacy">Privacy</button>
                            <button class="wizard-tab" data-tab="apps">Apps</button>
                        </div>
                        <form id="unattend-form">
                            <div class="wizard-panel" data-panel="system" style="display:block;">
                                <div class="form-group">
                                    <label for="computerName">Computer Name:</label>
                                    <input type="text" id="computerName" name="computerName" class="input-field" value="PC-NAME">
                                </div>
                                <div class="form-group">
                                    <label for="organization">Organization:</label>
                                    <input type="text" id="organization" name="organization" class="input-field" value="MyOrg">
                                </div>
                                <div class="form-group">
                                    <label for="owner">Owner:</label>
                                    <input type="text" id="owner" name="owner" class="input-field" value="Owner">
                                </div>
                                <div class="form-group">
                                    <label for="productKey">Product Key:</label>
                                    <input type="text" id="productKey" name="productKey" class="input-field" placeholder="XXXXX-XXXXX-XXXXX-XXXXX-XXXXX">
                                </div>
                                <div class="form-group">
                                    <label for="windowsEdition">Windows Edition:</label>
                                    <select id="windowsEdition" name="windowsEdition" class="input-field">
                                        <option>Windows 10 Pro</option>
                                        <option>Windows 10 Home</option>
                                        <option>Windows 11 Pro</option>
                                        <option>Windows 11 Home</option>
                                    </select>
                                </div>
                            </div>
                            <div class="wizard-panel" data-panel="regional" style="display:none;">
                                <div class="form-group">
                                    <label for="language">Language:</label>
                                    <select id="language" name="language" class="input-field">
                                        <option>English (US)</option>
                                        <option>English (UK)</option>
                                        <option>German</option>
                                        <option>French</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="timezone">Time Zone:</label>
                                    <select id="timezone" name="timezone" class="input-field">
                                        <option>UTC-6 Central</option>
                                        <option>UTC-5 Eastern</option>
                                        <option>UTC-8 Pacific</option>
                                        <option>UTC+1 Berlin</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="keyboard">Keyboard Layout:</label>
                                    <select id="keyboard" name="keyboard" class="input-field">
                                        <option>US</option>
                                        <option>UK</option>
                                        <option>German</option>
                                        <option>French</option>
                                    </select>
                                </div>
                            </div>
                            <div class="wizard-panel" data-panel="user" style="display:none;">
                                <div class="form-group">
                                    <label for="username">Username:</label>
                                    <input type="text" id="username" name="username" class="input-field" value="User">
                                </div>
                                <div class="form-group">
                                    <label for="password">Password:</label>
                                    <input type="password" id="password" name="password" class="input-field" autocomplete="new-password">
                                </div>
                                <div class="form-group">
                                    <label for="autoLogin">
                                        <input type="checkbox" id="autoLogin" name="autoLogin"> Enable Auto-Login
                                    </label>
                                </div>
                            </div>
                            <div class="wizard-panel" data-panel="privacy" style="display:none;">
                                <div class="form-group">
                                    <label><input type="checkbox" id="disableTelemetry" name="disableTelemetry"> Disable Telemetry</label>
                                </div>
                                <div class="form-group">
                                    <label><input type="checkbox" id="disableCortana" name="disableCortana"> Disable Cortana</label>
                                </div>
                                <div class="form-group">
                                    <label><input type="checkbox" id="disableLocation" name="disableLocation"> Disable Location Services</label>
                                </div>
                            </div>
                            <div class="wizard-panel" data-panel="apps" style="display:none;">
                                <div class="form-group">
                                    <label for="appsList">Preinstall Apps (comma separated):</label>
                                    <input type="text" id="appsList" name="appsList" class="input-field" placeholder="e.g. Chrome,7zip,VSCode">
                                </div>
                            </div>
                            <div class="flex justify-between mt-6">
                                <button type="button" class="btn btn-secondary" id="unattend-prev">&larr; Previous</button>
                                <button type="button" class="btn btn-primary" id="unattend-next">Next &rarr;</button>
                            </div>
                            <div class="text-right mt-6">
                                <button type="button" class="btn btn-secondary mr-2" id="export-json"><i class="fas fa-file-code"></i> Export JSON</button>
                                <button type="button" class="btn btn-secondary" id="export-xml"><i class="fas fa-file-alt"></i> Export XML</button>
                            </div>
                        </form>
                    </div>
                    <style>
                        .unattend-wizard { max-width: 700px; margin: 0 auto; background: #191919; }
                        .wizard-tabs { gap: 0.5rem; }
                        .wizard-tab { background: #23232a; color: #fff; border: none; padding: 0.5rem 1.2rem; border-radius: 0.5rem 0.5rem 0 0; margin-right: 0.25rem; cursor: pointer; font-weight: 500; transition: background 0.2s, color 0.2s; }
                        .wizard-tab.active { background: #333; color: #FF7810; }
                        .wizard-panel { margin-top: 1.5rem; }
                        .form-group { margin-bottom: 1.2rem; }
                        .form-group label { display: block; font-size: 1rem; margin-bottom: 0.4rem; color: #bbb; }
                        .input-field { width: 100%; padding: 0.5rem; border-radius: 0.3rem; border: 1px solid #444; background: #191919; color: #fff; }
                        .input-field:focus { border-color: #FF7810; outline: none; }
                        .btn { padding: 0.5rem 1.25rem; border-radius: 0.375rem; border: none; font-weight: 600; cursor: pointer; transition: background 0.2s, color 0.2s; }
                        .btn-primary { background: #FF7810; color: #fff; }
                        .btn-primary:hover { background: #e56700; }
                        .btn-secondary { background: #23232a; color: #FF7810; border: 1px solid #FF7810; }
                        .btn-secondary:hover { background: #333; color: #fff; }
                    </style>
                    <script>
                        // Wizard tab switching
                        const wizardTabs = Array.from(document.querySelectorAll('.wizard-tab'));
                        const wizardPanels = Array.from(document.querySelectorAll('.wizard-panel'));
                        let currentTabIdx = 0;
                        function showTab(idx) {
                            wizardTabs.forEach((tab, i) => tab.classList.toggle('active', i === idx));
                            wizardPanels.forEach((panel, i) => panel.style.display = i === idx ? 'block' : 'none');
                            currentTabIdx = idx;
                            document.getElementById('unattend-prev').disabled = (idx === 0);
                            document.getElementById('unattend-next').disabled = (idx === wizardTabs.length - 1);
                        }
                        wizardTabs.forEach((tab, idx) => {
                            tab.addEventListener('click', () => showTab(idx));
                        });
                        document.getElementById('unattend-next').addEventListener('click', () => {
                            if (currentTabIdx < wizardTabs.length - 1) {
                                showTab(currentTabIdx + 1);
                            }
                        });
                        document.getElementById('unattend-prev').addEventListener('click', () => {
                            if (currentTabIdx > 0) {
                                showTab(currentTabIdx - 1);
                            }
                        });
                    </script>
                    <script>
                        // Export as JSON or XML
                        function collectFormData() {
                            const data = {};
                            const form = document.getElementById('unattend-form');
                            new FormData(form).forEach((value, key) => {
                                if (data[key]) {
                                    if (!Array.isArray(data[key])) data[key] = [data[key]];
                                    data[key].push(value);
                                } else {
                                    data[key] = value;
                                }
                            });
                            // Handle checkboxes
                            ['disableTelemetry','disableCortana','disableLocation','autoLogin'].forEach(id => {
                                const el = document.getElementById(id);
                                if (el && el.type === 'checkbox') data[id] = el.checked;
                            });
                            return data;
                        }
                        function exportAsJSON() {
                            const data = collectFormData();
                            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
                            const a = document.createElement('a');
                            a.href = URL.createObjectURL(blob);
                            a.download = 'unattended_setup.json';
                            a.click();
                        }
                        function exportAsXML() {
                            const data = collectFormData();
                            let xml = '<UnattendedSetup>\n';
                            for (const [key, value] of Object.entries(data)) {
                                xml += `  <${key}>${String(value).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</${key}>\n`;
                            }
                            xml += '</UnattendedSetup>';
                            const blob = new Blob([xml], {type: 'application/xml'});
                            const a = document.createElement('a');
                            a.href = URL.createObjectURL(blob);
                            a.download = 'unattended_setup.xml';
                            a.click();
                        }
                        document.addEventListener('DOMContentLoaded', () => {
                            document.getElementById('export-json').onclick = exportAsJSON;
                            document.getElementById('export-xml').onclick = exportAsXML;
                        });
                    </script>
                </div>
            </div>

            <div id="tab-settings" class="tab-content" data-aos="fade-in">
                <div class="feature-section">
                    <h3><i class="fas fa-sliders-h"></i>Settings</h3>
                    <p>Configure WinTool options, manage updates, and customize behavior.</p>
                </div>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-neutral-800 rounded border border-neutral-700">
                        <label for="theme-select" class="text-gray-300">Theme</label>
                        <select id="theme-select" class="select-field">
                            <option value="dark">Dark (Default)</option>
                            <option value="light" disabled>Light (Coming Soon)</option>
                        </select>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-neutral-800 rounded border border-neutral-700">
                        <label class="text-gray-300">Update Channel</label>
                        <span class="text-green-400 font-semibold">Stable</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-neutral-800 rounded border border-neutral-700">
                        <label class="text-gray-300">Current Version</label>
                        <span class="text-green-400 font-semibold">v0.0.3a</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-neutral-800 rounded border border-neutral-700">
                        <label class="text-gray-300" for="sidebar-fold-toggle">Fold Sidebar Tabs</label>
                        <input type="checkbox" id="sidebar-fold-toggle" class="form-checkbox h-5 w-5 text-primary">
                    </div>
                    <div class="flex items-center justify-between p-3 bg-neutral-800 rounded border border-neutral-700">
                        <label class="text-gray-300" for="fps-counter-toggle">FPS Counter</label>
                        <input type="checkbox" id="fps-counter-toggle" class="form-checkbox h-5 w-5 text-primary">
                    </div>
                    <div class="flex items-center justify-between p-3 bg-neutral-800 rounded border border-neutral-700">
                        <label class="text-gray-300" for="alwaysOnTopToggle">Always on Top</label>
                        <input type="checkbox" id="alwaysOnTopToggle" class="form-checkbox h-5 w-5 text-primary">
                    </div>
                    <div class="flex items-center justify-between p-3 bg-neutral-800 rounded border border-neutral-700">
                        <label for="accent-color-picker" class="text-gray-300">Accent Color</label>
                        <input type="color" id="accent-color-picker" value="#ff9800" style="width: 2.5rem; height: 2.5rem; border: none; background: none; cursor: pointer;">
                        <button class="btn btn-secondary ml-3" id="reset-accent-color-btn" type="button"><i class="fas fa-undo"></i>Reset to Default</button>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-neutral-800 rounded border border-neutral-700">
                        <label class="text-gray-300">Tab Order</label>
                        <button class="action-btn accent-btn" id="reset-tab-order-btn" style="margin-top:0.5rem;">
                            <i class="fas fa-sync-alt"></i> Reset Tab Order to Default
                        </button>
                    </div>
                    <div class="text-center mt-6">
                        <button class="btn btn-secondary" id="check-updates"><i class="fas fa-sync-alt" ></i>Check for Updates</button>
                        <button class="action-btn ml-3" id="test-notification"><i class="fas fa-bell"></i>Test Notification</button>
                    </div>
                </div>
                <script>
                    // Always on Top toggle logic
                    document.addEventListener('DOMContentLoaded', function() {
                        const alwaysOnTopToggle = document.getElementById('alwaysOnTopToggle');
                        if(alwaysOnTopToggle && window.electronAPI) {
                            // Restore state
                            const saved = localStorage.getItem('alwaysOnTop');
                            if (saved !== null) {
                                alwaysOnTopToggle.checked = saved === '1';
                                window.electronAPI.setAlwaysOnTop && window.electronAPI.setAlwaysOnTop(alwaysOnTopToggle.checked);
                            } else {
                                window.electronAPI.getAlwaysOnTop && window.electronAPI.getAlwaysOnTop().then((isOnTop) => {
                                    alwaysOnTopToggle.checked = !!isOnTop;
                                    localStorage.setItem('alwaysOnTop', isOnTop ? '1' : '0');
                                });
                            }
                            alwaysOnTopToggle.addEventListener('change', function() {
                                window.electronAPI.setAlwaysOnTop && window.electronAPI.setAlwaysOnTop(alwaysOnTopToggle.checked);
                                localStorage.setItem('alwaysOnTop', alwaysOnTopToggle.checked ? '1' : '0');
                            });
                        }
                    });
                </script>
                <script>
                    // FPS Counter Toggle Handler
                    const fpsToggle = document.getElementById('fps-counter-toggle');
                    if (fpsToggle) {
                        fpsToggle.addEventListener('change', async (e) => {
                            try {
                                await window.electronAPI.setFpsCounter(e.target.checked);
                                showNotification('FPS Counter ' + (e.target.checked ? 'enabled' : 'disabled'), { type: 'success' });
                                showFpsOverlay(e.target.checked);
                            } catch (err) {
                                showErrorNotification('Failed to toggle FPS Counter: ' + err.message);
                            }
                        });
                    }

                    // Improved Accent Color Picker Logic
                    (function() {
                        const accentPicker = document.getElementById('accent-color-picker');
                        const defaultAccent = '#ff9800';
                        const accentTargets = [
                            '--primary', '--primary-dark',
                        ];
                        // All selectors that use the accent color
                        const styleSelectors = [
                            '[style*="#ff9800"]', '[style*="#FF9800"]', '[style*="#ff7810"]', '[style*="#FF7810"]',
                            '[style*="accent-color: #ff9800"]', '[style*="accent-color: #FF9800"]',
                            '[style*="#ffa733"]', '[style*="#FF5722"]', '[style*="#ff5722"]', '[style*="#ffa733"]',
                            '[style*="rgba(255, 152, 0"]', '[style*="rgba(255,120,20"]', '[style*="rgba(255, 120, 20"]',
                            '[style*="#ff9800a0"]', '[style*="#FF9800A0"]', '[style*="#ff9800a0"]', '[style*="#FF9800a0"]'
                        ];
                        // Utility classes for Tailwind
                        const tailwindClasses = [
                            'text-orange-400', 'text-orange-300', 'border-orange-400', 'bg-orange-400', 'bg-orange-300'
                        ];
                        // CSS rules to patch (for <style> blocks in the document)
                        const cssAccentRegex = /#ff9800|#FF9800|#ff7810|#FF7810|#ffa733|#FF5722|#ff5722|rgba\(255, 152, 0[^)]*\)|rgba\(255, ?120, ?20[^)]*\)|#ff9800a0/gi;
                        function setAccentColor(color) {
                            // Update CSS variables
                            accentTargets.forEach(v => document.documentElement.style.setProperty(v, color));
                            // Update inline styles
                            styleSelectors.forEach(sel => {
                                document.querySelectorAll(sel).forEach(el => {
                                    el.style.cssText = el.style.cssText.replace(cssAccentRegex, color);
                                    if ('accentColor' in el.style) el.style.accentColor = color;
                                });
                            });
                            // Update Tailwind utility classes
                            tailwindClasses.forEach(cls => {
                                document.querySelectorAll('.' + cls).forEach(el => {
                                    if (cls.startsWith('text-')) el.style.color = color;
                                    if (cls.startsWith('border-')) el.style.borderColor = color;
                                    if (cls.startsWith('bg-')) el.style.backgroundColor = color;
                                });
                            });
                            // Update gradients and backgrounds
                            document.querySelectorAll('[style*="linear-gradient"], [style*="background"]').forEach(el => {
                                el.style.cssText = el.style.cssText.replace(cssAccentRegex, color);
                            });
                            // Patch <style> blocks in the document (for static CSS)
                            document.querySelectorAll('style').forEach(styleTag => {
                                if (cssAccentRegex.test(styleTag.innerHTML)) {
                                    styleTag.innerHTML = styleTag.innerHTML.replace(cssAccentRegex, color);
                                }
                            });
                            // Patch inline <style> attribute in <body> and <html>
                            ['body','html'].forEach(tag => {
                                const el = document.querySelector(tag);
                                if (el && el.hasAttribute('style')) {
                                    el.setAttribute('style', el.getAttribute('style').replace(cssAccentRegex, color));
                                }
                            });
                            // Patch system tools icons (force accent color on icons in tools tab)
                            function patchSystemToolIcons(color) {
                                // Icons in system tools are rendered with .text-orange-400 or inline style
                                document.querySelectorAll('.tab-content[data-tab="tools"] .fa, .tab-content[data-tab="tools"] i').forEach(icon => {
                                    icon.style.color = color;
                                });
                                // Also patch any .text-orange-400 etc. in tools tab
                                document.querySelectorAll('.tab-content[data-tab="tools"] .text-orange-400, .tab-content[data-tab="tools"] .text-orange-300').forEach(el => {
                                    el.style.color = color;
                                });
                            }
                            patchSystemToolIcons(color);
                            // Patch Discord join button color
                            function patchDiscordButton(color) {
                                document.querySelectorAll('a[href*="discord.gg"]').forEach(btn => {
                                    btn.style.background = color;
                                    btn.style.border = 'none';
                                    btn.style.color = '#fff';
                                });
                            }
                            patchDiscordButton(color);
                            // Save to localStorage
                            localStorage.setItem('accentColor', color);
                        }
                        if (accentPicker) {
                            // Load saved color
                            const savedAccent = localStorage.getItem('accentColor') || defaultAccent;
                            accentPicker.value = savedAccent;
                            setAccentColor(savedAccent);
                            let pendingAccent = null;
                            accentPicker.addEventListener('input', (e) => {
                                setAccentColor(e.target.value);
                                pendingAccent = e.target.value;
                            });
                            accentPicker.addEventListener('change', (e) => {
                                if (pendingAccent) {
                                    setTimeout(() => {
                                        location.reload();
                                    }, 100);
                                }
                            });
                            const resetBtn = document.getElementById('reset-accent-color-btn');
                            if (resetBtn) {
                                resetBtn.addEventListener('click', function() {
                                    accentPicker.value = defaultAccent;
                                    if (typeof setAccentColor === 'function') setAccentColor(defaultAccent);
                                    setTimeout(() => {
                                        location.reload();
                                    }, 100);
                                });
                            }
                        }
                    })();
                </script>
                <script>
                    document.getElementById('reset-tab-order-btn').onclick = function() {
                        localStorage.removeItem('tabOrder');
                        const tabList = document.getElementById('winToolTabs');
                        const defaultOrder = [
                            'welcome','dashboard','tweaks','packages','tools','gaming','setup','settings', 'about'
                        ];
                        const tabs = Array.from(tabList.children);
                        defaultOrder.forEach(tabData => {
                            const tab = tabs.find(t => t.dataset.tab === tabData);
                            if (tab) tabList.appendChild(tab);
                        });
                        showNotification('Tab order reset to default!', { type: 'success' });
                    };
                </script>
            </div>

            <div id="tab-about" class="tab-content" data-aos="fade-in" style="display:none; max-width: 700px; margin: 0 auto;">
                <div class="feature-section">
                    <h3><i class="fas fa-info-circle"></i> About WinTool</h3>
                    <p><b>WinTool</b> is a utility application for Windows designed to help you manage your system and improve your experience.</p>
                    <div class="about-details" style="margin-top:1.2rem;">
                        <div><b>Author:</b> MTechWare</div>
                        <div><b>GitHub:</b> <a href="https://github.com/MTechWare/wintool" target="_blank">https://github.com/MTechWare/wintool</a></div>
                    </div>
                    <hr style="margin:1.5rem 0;">
                    <div style="font-size:0.98rem;color:#888;">
                        &copy; 2025 WinTool. All rights reserved.<br>
                        This project is open source and provided as-is with no warranty.
                    </div>
                </div>
            </div>
        </div> 
    </div> 
    <!-- Notification Toast -->
    <div id="notification-toast" class="notification-toast" style="display:none;">
        <span class="toast-icon"><i class="fas fa-bell"></i></span>
        <span class="toast-message">Test notification!</span>
        <button class="toast-close" aria-label="Close notification">&times;</button>
    </div>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // Initialize AOS animations
        AOS.init({
            duration: 600, // Animation duration
            once: true,    // Animate only once
            offset: 20,    // Offset (in px) from the original trigger point
        });

        // Make the X (close) button work in Electron
        document.addEventListener('DOMContentLoaded', () => {
            const closeBtn = document.getElementById('closeBtn');
            if (closeBtn && window.electronAPI) {
                closeBtn.addEventListener('click', () => {
                    window.electronAPI.closeWindow && window.electronAPI.closeWindow();
                });
            }
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const closeBtn = document.getElementById('closeBtn');
            if(closeBtn && window.electronAPI) {
                closeBtn.addEventListener('click', function() {
                    window.electronAPI.closeWindow && window.electronAPI.closeWindow();
                });
            }
        });
    </script>

    <script>
        // Tab switching logic (simple and consistent for all tabs)
        document.addEventListener('DOMContentLoaded', function() {
            const tabItems = document.querySelectorAll('.tab-item');
            const tabContents = document.querySelectorAll('.tab-content');
            tabItems.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabItems.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const target = tab.getAttribute('data-tab');
                    tabContents.forEach(c => {
                        c.classList.remove('active');
                        c.style.display = 'none';
                        if (c.id === 'tab-' + target) {
                            c.classList.add('active');
                            c.style.display = 'block';
                        }
                    });
                });
            });
            // Gaming Tweaks Button
            const gamingBtn = document.getElementById('apply-gaming-tweaks');
            if (gamingBtn) {
                gamingBtn.addEventListener('click', function() {
                    showNotification('Gaming and performance tweaks will be available in a future update!', { type: 'info' });
                });
            }
        });
    </script>

    <script>
        // Settings tab logic
        document.addEventListener('DOMContentLoaded', () => {
            // Theme
            const themeSelect = document.getElementById('theme-select');
            if (themeSelect) {
                themeSelect.value = localStorage.getItem('theme') || 'dark';
                themeSelect.addEventListener('change', () => {
                    localStorage.setItem('theme', themeSelect.value);
                });
            }
            // Reset Settings
            const resetBtn = document.getElementById('reset-settings');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    if (confirm('Are you sure you want to reset all settings?')) {
                        localStorage.removeItem('theme');
                        location.reload();
                    }
                });
            }
            // Check for Updates (placeholder)
            const checkUpdatesBtn = document.getElementById('check-updates');
            if (checkUpdatesBtn) {
                checkUpdatesBtn.addEventListener('click', () => {
                    showNotification('Checking for updates... (This does not work yet)');
                });
            }
        });
    </script>

    <script>
        // Notification logic
        function showNotification(message) {
            const toast = document.getElementById('notification-toast');
            const msgSpan = toast.querySelector('.toast-message');
            msgSpan.textContent = message;
            toast.style.display = 'flex';
            setTimeout(() => toast.classList.add('show'), 10);
            // Auto-hide after 3.5s
            if (toast._hideTimeout) clearTimeout(toast._hideTimeout);
            toast._hideTimeout = setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => { toast.style.display = 'none'; }, 350);
            }, 3500);
        }
        function showErrorNotification(message) {
            showNotification('Error: ' + message);
        }
        document.addEventListener('DOMContentLoaded', () => {
            // Test Notification button
            const testBtn = document.getElementById('test-notification');
            if (testBtn) {
                testBtn.addEventListener('click', () => showNotification('This is a test notification!'));
            }
            // Close button for toast
            const toast = document.getElementById('notification-toast');
            const closeBtn = toast.querySelector('.toast-close');
            closeBtn.addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => { toast.style.display = 'none'; }, 350);
            });
        });
    </script>
    <div id="fps-overlay" style="display:none;position:fixed;bottom:16px;left:32px;z-index:99999;background:rgba(20,20,25,0.86);color:var(--primary);font-size:1.15rem;font-family:'Roboto Mono',monospace;padding:6px 18px;border-radius:0.6rem;box-shadow:0 2px 12px #000a;pointer-events:none;user-select:none;">
        FPS: <span id="fps-value">0</span>
    </div>
    <script>
        let fpsIntervalId = null;
        function showFpsOverlay(show) {
            const overlay = document.getElementById('fps-overlay');
            if (!overlay) return;
            if (show) {
                overlay.style.display = '';
                let lastFrame = performance.now();
                let frames = 0;
                let lastFps = 0;
                function updateFps() {
                    frames++;
                    const now = performance.now();
                    if (now - lastFrame >= 1000) {
                        lastFps = frames;
                        document.getElementById('fps-value').textContent = lastFps;
                        frames = 0;
                        lastFrame = now;
                    }
                    if (overlay.style.display !== 'none') {
                        requestAnimationFrame(updateFps);
                    }
                }
                requestAnimationFrame(updateFps);
            } else {
                overlay.style.display = 'none';
                document.getElementById('fps-value').textContent = '0';
            }
        }
    </script>
    <script>
        // Make tabs draggable/reorderable and persist order
        document.addEventListener('DOMContentLoaded', () => {
            const tabList = document.getElementById('winToolTabs');
            let draggedTab = null;
            let dragOverTab = null;

            // Restore saved tab order
            const savedOrder = JSON.parse(localStorage.getItem('tabOrder') || 'null');
            if (savedOrder && Array.isArray(savedOrder)) {
                const tabs = Array.from(tabList.children);
                savedOrder.forEach(tabData => {
                    const tab = tabs.find(t => t.dataset.tab === tabData);
                    if (tab) tabList.appendChild(tab);
                });
            }

            function saveTabOrder() {
                const order = Array.from(tabList.children).map(tab => tab.dataset.tab);
                localStorage.setItem('tabOrder', JSON.stringify(order));
            }

            tabList.querySelectorAll('.tab-item').forEach(tab => {
                tab.draggable = true;
                tab.addEventListener('dragstart', (e) => {
                    draggedTab = tab;
                    e.dataTransfer.effectAllowed = 'move';
                    setTimeout(() => tab.classList.add('dragging'), 0);
                });
                tab.addEventListener('dragend', () => {
                    draggedTab = null;
                    tab.classList.remove('dragging');
                });
                tab.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dragOverTab = tab;
                });
                tab.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedTab && draggedTab !== tab) {
                        tabList.insertBefore(draggedTab, tab.nextSibling);
                        saveTabOrder();
                    }
                    tab.classList.remove('drag-over');
                });
                tab.addEventListener('dragenter', () => {
                    tab.classList.add('drag-over');
                });
                tab.addEventListener('dragleave', () => {
                    tab.classList.remove('drag-over');
                });
            });
        });
    </script>
</body>
</html>
